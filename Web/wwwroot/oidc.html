<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title></title>
</head>
<body>
	<button id="login">Login</button>
	<button id="api">Call API</button>
	<button id="logout">Logout</button>

	<pre id="results"></pre>
	<script src="/oidc-client/oidc-client.min.js"></script>
	<script>
		function log() {
			document.getElementById('results').innerText = '';

			Array.prototype.forEach.call(arguments, function (msg) {
				if (msg instanceof Error) {
					msg = "Error: " + msg.message;
				}
				else if (typeof msg !== 'string') {
					msg = JSON.stringify(msg, null, 2);
				}
				document.getElementById('results').innerHTML += msg + '\r\n';
			});
		}
		document.getElementById("login").addEventListener("click", login, false);
		document.getElementById("api").addEventListener("click", api, false);
		document.getElementById("logout").addEventListener("click", logout, false);

		var config = {
			authority: "https://localhost:44326/",
			client_id: "brvesqplaedoadrhklar",
			redirect_uri: "https://localhost:44328/callback.html",
			response_type: "code",
			scope: "orders:read",
			post_logout_redirect_uri: "https://localhost:44328/oidc.html",
		};
		var mgr = new Oidc.UserManager(config);

		function login() {
			mgr.signinRedirect();
		}

		function api() {
			mgr.getUser().then(function (user) {
				var url = "http://localhost:44326/identity";

				var xhr = new XMLHttpRequest();
				xhr.open("GET", url);
				xhr.onload = function () {
					log(xhr.status, JSON.parse(xhr.responseText));
				}
				xhr.setRequestHeader("Authorization", "Bearer " + user.access_token);
				xhr.send();
			});
		}

		function logout() {
			mgr.signoutRedirect();
		}
	</script>
</body>
</html>